if(!Suggest){var Suggest={}}Suggest.Key={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40};Suggest.copyProperties=function(e,t){for(var n in t){e[n]=t[n]}return e};Suggest.Local=function(){this.initialize.apply(this,arguments)};Suggest.Local.prototype={initialize:function(e,t,n){this.input=this._getElement(e);this.suggestArea=this._getElement(t);this.candidateList=n;this.oldText=this.getInputText();if(arguments[3])this.setOptions(arguments[3]);this._addEvent(this.input,"focus",this._bind(this.checkLoop));this._addEvent(this.input,"blur",this._bind(this.inputBlur));this._addEvent(this.suggestArea,"blur",this._bind(this.inputBlur));this._addEvent(this.input,"keydown",this._bindEvent(this.keyEvent));this.clearSuggestArea()},interval:500,dispMax:20,listTagName:"div",prefix:false,ignoreCase:true,highlight:false,dispAllKey:false,classMouseOver:"over",classSelect:"select",hookBeforeSearch:function(){},setOptions:function(e){Suggest.copyProperties(this,e)},inputBlur:function(){setTimeout(this._bind(function(){if(document.activeElement==this.suggestArea||document.activeElement==this.input){return}this.changeUnactive();this.oldText=this.getInputText();if(this.timerId)clearTimeout(this.timerId);this.timerId=null;setTimeout(this._bind(this.clearSuggestArea),500)},500))},checkLoop:function(){var e=this.getInputText();if(e!=this.oldText){this.oldText=e.replace("候補:","").replace("　　 ","");this.search()}if(this.timerId)clearTimeout(this.timerId);this.timerId=setTimeout(this._bind(this.checkLoop),this.interval)},search:function(){this.clearSuggestArea();var e=this.getInputText();if(e==""||e==null)return;this.hookBeforeSearch(e);var t=this._search(e);if(t.length!=0)this.createSuggestArea(t)},_search:function(e){var t=[];var n;this.suggestIndexList=[];for(var r=0,i=this.candidateList.length;r<i;r++){if((n=this.isMatch(this.candidateList[r],e[r]))!=null){t.push(n);this.suggestIndexList.push(r);if(this.dispMax!=0&&t.length>=this.dispMax)break}}return t},isMatch:function(e,t){if(e==null)return null;var n=this.ignoreCase?e.toLowerCase().indexOf(t.toLowerCase()):e.indexOf(t);if(n==-1||this.prefix&&n!=0)return null;if(this.highlight){return this._escapeHTML(e.substr(0,n))+"<strong>"+this._escapeHTML(e.substr(n,t.length))+"</strong>"+this._escapeHTML(e.substr(n+t.length))}else{return this._escapeHTML(e)}},clearSuggestArea:function(){this.suggestArea.innerHTML="";this.suggestArea.style.display="none";this.suggestList=null;this.suggestIndexList=null;this.activePosition=null},createSuggestArea:function(e){this.suggestList=[];this.inputValueBackup=this.input.value;for(var t=0,n=e.length;t<n;t++){var r=document.createElement(this.listTagName);r.innerHTML=e[t];this.suggestArea.appendChild(r);this._addEvent(r,"click",this._bindEvent(this.listClick,t));this._addEvent(r,"mouseover",this._bindEvent(this.listMouseOver,t));this._addEvent(r,"mouseout",this._bindEvent(this.listMouseOut,t));this.suggestList.push(r)}this.suggestArea.style.display="";this.suggestArea.scrollTop=0},getInputText:function(){return this.input.value},setInputText:function(e){this.input.value=e.replace("候補:","").replace("　　 ","")},keyEvent:function(e){if(!this.timerId){this.timerId=setTimeout(this._bind(this.checkLoop),this.interval)}if(this.dispAllKey&&e.ctrlKey&&this.getInputText()==""&&!this.suggestList&&e.keyCode==Suggest.Key.DOWN){this._stopEvent(e);this.keyEventDispAll()}else if(e.keyCode==Suggest.Key.UP||e.keyCode==Suggest.Key.DOWN){if(this.suggestList&&this.suggestList.length!=0){this._stopEvent(e);this.keyEventMove(e.keyCode)}}else if(e.keyCode==Suggest.Key.RETURN){if(this.suggestList&&this.suggestList.length!=0){this._stopEvent(e);this.keyEventReturn()}}else if(e.keyCode==Suggest.Key.ESC){if(this.suggestList&&this.suggestList.length!=0){this._stopEvent(e);this.keyEventEsc()}}else{this.keyEventOther(e)}},keyEventDispAll:function(){this.clearSuggestArea();this.oldText=this.getInputText();this.suggestIndexList=[];for(var e=0,t=this.candidateList.length;e<t;e++){this.suggestIndexList.push(e)}this.createSuggestArea(this.candidateList)},keyEventMove:function(e){this.changeUnactive();if(e==Suggest.Key.UP){if(this.activePosition==null){this.activePosition=this.suggestList.length-1}else{this.activePosition--;if(this.activePosition<0){this.activePosition=null;this.input.value=this.inputValueBackup;this.suggestArea.scrollTop=0;return}}}else{if(this.activePosition==null){this.activePosition=0}else{this.activePosition++}if(this.activePosition>=this.suggestList.length){this.activePosition=null;this.input.value=this.inputValueBackup;this.suggestArea.scrollTop=0;return}}this.changeActive(this.activePosition)},keyEventReturn:function(){this.clearSuggestArea();this.moveEnd()},keyEventEsc:function(){this.clearSuggestArea();this.input.value=this.inputValueBackup;this.oldText=this.getInputText();if(window.opera)setTimeout(this._bind(this.moveEnd),5)},keyEventOther:function(e){},changeActive:function(e){this.setStyleActive(this.suggestList[e]);this.setInputText(this.candidateList[this.suggestIndexList[e]]);this.oldText=this.getInputText();this.input.focus()},changeUnactive:function(){if(this.suggestList!=null&&this.suggestList.length>0&&this.activePosition!=null){this.setStyleUnactive(this.suggestList[this.activePosition])}},listClick:function(e,t){this.changeUnactive();this.activePosition=t;this.changeActive(t);this.clearSuggestArea();this.moveEnd()},listMouseOver:function(e,t){this.setStyleMouseOver(this._getEventElement(e))},listMouseOut:function(e,t){if(!this.suggestList)return;var n=this._getEventElement(e);if(t==this.activePosition){this.setStyleActive(n)}else{this.setStyleUnactive(n)}},setStyleActive:function(e){e.className=this.classSelect;var t=e.offsetTop;var n=t+e.clientHeight;if(this.suggestArea.scrollTop>t){this.suggestArea.scrollTop=t}else if(this.suggestArea.scrollTop+this.suggestArea.clientHeight<n){this.suggestArea.scrollTop=n-this.suggestArea.clientHeight}},setStyleUnactive:function(e){e.className=""},setStyleMouseOver:function(e){e.className=this.classMouseOver},moveEnd:function(){if(this.input.createTextRange){this.input.focus();var e=this.input.createTextRange();e.move("character",this.input.value.length);e.select()}else if(this.input.setSelectionRange){this.input.setSelectionRange(this.input.value.length,this.input.value.length)}},_getElement:function(e){return typeof e=="string"?document.getElementById(e):e},_addEvent:window.addEventListener?function(e,t,n){e.addEventListener(t,n,false)}:function(e,t,n){e.attachEvent("on"+t,n)},_stopEvent:function(e){if(e.preventDefault){e.preventDefault();e.stopPropagation()}else{e.returnValue=false;e.cancelBubble=true}},_getEventElement:function(e){return e.target||e.srcElement},_bind:function(e){var t=this;var n=Array.prototype.slice.call(arguments,1);return function(){e.apply(t,n)}},_bindEvent:function(e){var t=this;var n=Array.prototype.slice.call(arguments,1);return function(r){r=r||window.event;e.apply(t,[r].concat(n))}},_escapeHTML:function(e){return e.replace(/\&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;")}};Suggest.LocalMulti=function(){this.initialize.apply(this,arguments)};Suggest.copyProperties(Suggest.LocalMulti.prototype,Suggest.Local.prototype);Suggest.LocalMulti.prototype.delim=" ";Suggest.LocalMulti.prototype.keyEventReturn=function(){this.clearSuggestArea();this.input.value+=this.delim;this.moveEnd()};Suggest.LocalMulti.prototype.keyEventOther=function(e){if(e.keyCode==Suggest.Key.TAB){if(this.suggestList&&this.suggestList.length!=0){this._stopEvent(e);if(!this.activePosition){this.activePosition=0;this.changeActive(this.activePosition)}this.clearSuggestArea();this.input.value+=this.delim;if(window.opera){setTimeout(this._bind(this.moveEnd),5)}else{this.moveEnd()}}}};Suggest.LocalMulti.prototype.listClick=function(e,t){this.changeUnactive();this.activePosition=t;this.changeActive(t);this.input.value+=this.delim;this.clearSuggestArea();this.moveEnd()};Suggest.LocalMulti.prototype.getInputText=function(){var e=this.getLastTokenPos();if(e==-1){return this.input.value}else{return this.input.value.substr(e+1)}};Suggest.LocalMulti.prototype.setInputText=function(e){var t=this.getLastTokenPos();if(t==-1){this.input.value=e.replace("候補:","").replace("　　 ","")}else{this.input.value=this.input.value.substr(0,t+1)+e.replace("候補:","").replace("　　 ","")}};Suggest.LocalMulti.prototype.getLastTokenPos=function(){return this.input.value.lastIndexOf(this.delim)}